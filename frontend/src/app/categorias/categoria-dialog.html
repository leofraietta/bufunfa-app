<div class="categoria-dialog-container">
  <h2 mat-dialog-title>
    <mat-icon>category</mat-icon>
    {{ isEdit ? 'Editar Categoria' : 'Nova Categoria' }}
  </h2>

  <mat-dialog-content>
    <form [formGroup]="categoriaForm" class="categoria-form">
      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nome da Categoria</mat-label>
          <input matInput 
                 formControlName="nome" 
                 placeholder="Ex: Alimentação, Transporte, Lazer">
          <mat-icon matSuffix>label</mat-icon>
          <mat-error *ngIf="categoriaForm.get('nome')?.hasError('required')">
            Nome é obrigatório
          </mat-error>
          <mat-error *ngIf="categoriaForm.get('nome')?.hasError('minlength')">
            Nome deve ter pelo menos 2 caracteres
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Valor Provisionado Mensal</mat-label>
          <input matInput 
                 type="number" 
                 formControlName="valorProvisionado" 
                 placeholder="0,00"
                 min="0"
                 step="0.01">
          <span matPrefix>R$ </span>
          <mat-icon matSuffix>account_balance_wallet</mat-icon>
          <mat-hint>Valor que você planeja gastar mensalmente nesta categoria</mat-hint>
          <mat-error *ngIf="categoriaForm.get('valorProvisionado')?.hasError('required')">
            Valor provisionado é obrigatório
          </mat-error>
          <mat-error *ngIf="categoriaForm.get('valorProvisionado')?.hasError('min')">
            Valor deve ser maior ou igual a zero
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Conta Associada</mat-label>
          <mat-select formControlName="contaId">
            <mat-option *ngFor="let conta of contas" [value]="conta.id">
              <div class="conta-option">
                <mat-icon>{{ conta.tipo === 1 ? 'account_balance' : 'credit_card' }}</mat-icon>
                <span>{{ conta.nome }}</span>
              </div>
            </mat-option>
          </mat-select>
          <mat-icon matSuffix>account_balance</mat-icon>
          <mat-hint>Selecione a conta onde os gastos desta categoria serão registrados</mat-hint>
          <mat-error *ngIf="categoriaForm.get('contaId')?.hasError('required')">
            Conta é obrigatória
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-checkbox formControlName="ativa" color="primary">
          Categoria ativa
        </mat-checkbox>
        <mat-hint class="checkbox-hint">
          Categorias inativas não aparecerão nas opções de lançamentos
        </mat-hint>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()" [disabled]="isLoading">
      Cancelar
    </button>
    <button mat-raised-button 
            color="primary" 
            (click)="onSave()" 
            [disabled]="!categoriaForm.valid || isLoading">
      <mat-spinner diameter="20" *ngIf="isLoading"></mat-spinner>
      <span *ngIf="!isLoading">{{ isEdit ? 'Atualizar' : 'Criar' }}</span>
    </button>
  </mat-dialog-actions>
</div>
