<div class="modern-dialog">
  <h2 mat-dialog-title>
    <mat-icon>account_balance</mat-icon>
    {{ isEdit ? 'Editar Conta' : 'Nova Conta' }}
  </h2>

  <mat-dialog-content>
    <form [formGroup]="contaForm" class="modern-form">
    
      <div class="form-row single">
        <mat-form-field appearance="outline">
          <mat-label>Nome da Conta</mat-label>
          <input matInput formControlName="nome" placeholder="Ex: Conta Corrente, Cartão Visa">
          <mat-icon matSuffix>edit</mat-icon>
          <mat-error *ngIf="contaForm.get('nome')?.hasError('required')">
            Nome é obrigatório
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row single">
        <mat-form-field appearance="outline">
          <mat-label>Descrição</mat-label>
          <textarea matInput formControlName="descricao" placeholder="Descrição da conta" rows="2"></textarea>
          <mat-icon matSuffix>description</mat-icon>
          <mat-error *ngIf="contaForm.get('descricao')?.hasError('required')">
            Descrição é obrigatória
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row single">
        <mat-form-field appearance="outline">
          <mat-label>Tipo de Conta</mat-label>
          <mat-select formControlName="tipo" (selectionChange)="onTipoChange($event.value)">
            <mat-option [value]="1">
              <mat-icon>account_balance</mat-icon>
              <span>Conta Corrente</span>
            </mat-option>
            <mat-option [value]="2">
              <mat-icon>savings</mat-icon>
              <span>Conta Poupança</span>
            </mat-option>
            <mat-option [value]="3">
              <mat-icon>credit_card</mat-icon>
              <span>Cartão de Crédito</span>
            </mat-option>
            <mat-option [value]="4">
              <mat-icon>trending_up</mat-icon>
              <span>Conta Investimento</span>
            </mat-option>
          </mat-select>
          <mat-icon matSuffix>category</mat-icon>
          <mat-error *ngIf="contaForm.get('tipo')?.hasError('required')">
            Tipo é obrigatório
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row single">
        <mat-form-field appearance="outline">
          <mat-label>Saldo Inicial</mat-label>
          <input matInput type="text" formControlName="saldoInicial" placeholder="1.000,00" 
                 (input)="onCurrencyInput($event, 'saldoInicial')"
                 (blur)="onCurrencyBlur($event, 'saldoInicial')">
          <span matTextPrefix>R$ </span>
          <mat-icon matSuffix>account_balance_wallet</mat-icon>
          <mat-hint>Saldo atual da conta no momento do cadastro</mat-hint>
          <mat-error *ngIf="contaForm.get('saldoInicial')?.hasError('required')">
            Saldo inicial é obrigatório
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Campos específicos para Cartão de Crédito -->
      <div *ngIf="isCartaoCredito" class="special-section" data-title="Configurações do Cartão">
        <div class="form-row double">
          <mat-form-field appearance="outline">
            <mat-label>Dia de Fechamento</mat-label>
            <input matInput type="number" formControlName="diaFechamento" placeholder="Ex: 5" min="1" max="31">
            <mat-icon matSuffix>event</mat-icon>
            <mat-hint>Dia do mês em que a fatura fecha</mat-hint>
            <mat-error *ngIf="contaForm.get('diaFechamento')?.hasError('required')">
              Dia de fechamento é obrigatório
            </mat-error>
            <mat-error *ngIf="contaForm.get('diaFechamento')?.hasError('min') || contaForm.get('diaFechamento')?.hasError('max')">
              Dia deve estar entre 1 e 31
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Dia de Vencimento</mat-label>
            <input matInput type="number" formControlName="diaVencimento" placeholder="Ex: 15" min="1" max="31">
            <mat-icon matSuffix>schedule</mat-icon>
            <mat-hint>Dia do mês para pagamento da fatura</mat-hint>
            <mat-error *ngIf="contaForm.get('diaVencimento')?.hasError('required')">
              Dia de vencimento é obrigatório
            </mat-error>
            <mat-error *ngIf="contaForm.get('diaVencimento')?.hasError('min') || contaForm.get('diaVencimento')?.hasError('max')">
              Dia deve estar entre 1 e 31
            </mat-error>
          </mat-form-field>
        </div>
      </div>

    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()" [disabled]="isLoading">
      Cancelar
    </button>
    <button mat-raised-button color="primary" 
            [disabled]="contaForm.invalid || isLoading" 
            (click)="onSave()">
      <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
      <span *ngIf="!isLoading">{{ isEdit ? 'Atualizar' : 'Criar' }}</span>
    </button>
  </mat-dialog-actions>
</div>

